{% extends 'base.html' %}
{% block header %}
<div align="center">
    <h5>{% block title %}
    <div class="container">
        <div class="jumbotron">
            <h1>Mouse Clicker</h1>      
            <p>This mouse clicker allows you to add actions and run those actions sequentially.</p>
        </div>    
    </div>
    {% endblock %}</h5>
</div>
{% endblock %}

{% block content %}
<!-- <div class="container">
    <div class="row">
        <div class="col">
            <div class="selectionAction">
            <form>
                <select name="actions" id="actions" class="custom-select mb-3">
                    <option selected disabled>Select Actions</option>
                    <option value="mouse">Click Mouse</option>
                    <option value="key">Press Key</option>
                </select>
            </form>
        </div>
        </div>
        <div class="col">
            <form>
                <select name="target" id="target-mouse" class="custom-select mb-3">
                    <option selected disabled>Choose action on the left</option>
                </select>
            </form>
            <input style="display:none;" name="target" id="target-key" type="text" class="form-control" placeholder="Key to be press">
        </div>
        <div class="col">
            <form>
                <select name="duration" id="duration" class="custom-select mb-3">
                    <option selected disabled>Select Actions</option>
                    <option value="mouse">Click Mouse</option>
                    <option value="key">Press Key</option>
                </select>
            </form>
        </div>
        <div class="col">
            <form>
                <select name="holding" id="holding" class="custom-select mb-3">
                    <option selected disabled>Select Actions</option>
                    <option value="mouse">Click Mouse</option>
                    <option value="key">Press Key</option>
                </select>
            </form>
        </div>
</div> -->
<div id="message">
    <div style="padding: 5px;">
        <div id="saved-msg" class="alert alert-info alert-dismissible" style="display: none">
            <button type="button" class="close" data-dismiss="alert">&times;</button>
            <strong>Success!</strong> Actions saved. Ready to start.
        </div>
        <div id="error-fill-msg" class="alert alert-danger alert-dismissible" style="display: none">
            <button type="button" class="close" data-dismiss="alert">&times;</button>
            <strong>Error!</strong> Please fill all options before saving actions.</strong>
        </div>
    </div>
</div>
    
<div class="container-fluid">
    <div class="row">
        <div class="col-sm-8">
            <button type="button" class="btn btn-info add-new mb-3" data-toggle="tooltip" title="Add new action"><i class="fa fa-plus"></i> Add New Action</button>
            <button type="button" class="btn btn-success save-act mb-3" data-toggle="tooltip" title="Save all actions"><i class="fa fa-plus"></i> Save Actions</button>
            <button type="button" class="btn btn-primary run-act mb-3" data-toggle="tooltip" title="Run actions" disabled><i class="fa fa-plus"></i> Run Actions</button>
            <button type="button" class="btn btn-danger stop-act mb-3" data-toggle="tooltip" title="Stop running" disabled><i class="fa fa-plus"></i> Stop Running</button>
        </div>
    </div>
    <div class="row">
    <table class="table table-striped" id = "actionTable">
            <thead>
                <tr>
                    <!-- <th>Action Number</th> -->
                    <th>Action</th>
                    <th>Action On</th>
                    <th>Delay(s)</th>
                    <th>Holding</th>
                    <th>Duration(s)</th>
                    <th>Delete Action</th>
                </tr>
            </thead>
        </table>
    </div>
</div>
</div>  
{% endblock %}

{% block script %}
<script>

var delayInMilliseconds = 3000;

$(document).ready(function(){
    $('[data-toggle="tooltip"]').tooltip();
    // Append table with add row form on add new button click
    $(".add-new").click(function(){
        var index = $("table tbody tr:last-child").index();
        var row =   
                '<tr>' +     
                '<td class="ActionRow">' +
                '<form>' + 
                '<select name="actions" id="actions" class="form-control mb-3">' +
                '<option selected disabled>Select Actions</option>' + 
                '<option value="mouse">Click Mouse</option>' +
                '<option value="key">Press Key</option>' +
                '</select>' +
                '</form>' +
                '</td>' +
                '<td>' +
                '<form>' +
                '<select name="target" id="target-mouse" class="form-control mb-3">' +
                '<option selected disabled>Choose action on the left</option>' +
                '</select>' +
                '</form>' +
                '<input style="display:none;" name="target" id="target-key" type="text" class="form-control" placeholder="Key to be press">' +
                '</td>' +
                '<td>' +
                '<input name="delay" id="delay" type="text" class="form-control" placeholder="Delay in seconds">' +
                '</td>' +
                '<td>' +
                '<form>' +
                '<select name="holding" id="holding" class="form-control mb-3">' +
                '<option selected>No</option>' +
                '<option>Yes</option>' +
                '</select>' +
                '</form>' +
                '</td>' +
                '<td>' +
                '<input name="duration" id="duration" type="text" class="form-control" placeholder="Duration in seconds">' +
                '</td>' +
                '<td>' +
                '<a class="delete" title="Delete" data-toggle="tooltip"><i class="material-icons">&#xE872;</i></a>' +
                '</td>' +
                '</tr>';
        $("table").append(row);	
    });

    $(".save-act").click(function(){
        var empty = false;
        var selectinput = $("#actionTable").find("select");
        var forminput = $("#actionTable").find("input");
        selectinput.each(function(){
            // console.log($(this).val());
            // $(this).addClass("error");
            if($(this).val() == null){
                $(this).addClass("error");
                empty = true;
            }
        });
        forminput.each(function(){
            if(!$(this).val()){
                $(this).addClass("error");
                empty = true;
            }
        });
        if(empty){
            $("#message").css("z-index", 999);
            $("#error-fill-msg").show().delay(1300).fadeOut();
            setTimeout(function() {
                $("#message").css("z-index", -1);
            }, 1300);
            //$("#error-fill-msg").addClass("in").delay(1000).fadeOut();
        }
        else{
            $("#message").css("z-index", 999);
            $("#saved-msg").show().delay(1300).fadeOut();
            setTimeout(function() {
                $("#message").css("z-index", -1);
            }, 1300);
            //$("#saved-msg").addClass("in").delay(1000).fadeOut();
        };
        
        
    });
        
    // Delete row on delete button click
	$(document).on("click", ".delete", function(){
        $(this).parents("tr").remove();
	    $(".add-new").removeAttr("disabled");
    });

    $(document).on("change", "#actions", function(){
        var $dropdown = $(this);
        var key = $dropdown.val();
        var $targetmouse = $(this).parents('tr').find("select[id='target-mouse']");
        var $targetkey = $(this).parents('tr').find("input[id='target-key']");
        console.log(key);
        switch(key) {
            case "mouse":
                var vals = ["Left-Click", "Right-Click"]
                //$targetkey.hide();
                //$targetmouse.show();
                //$targetmouse.empty();
                $.each(vals, function(index, value){
                    $targetmouse.append("<option>" + value + "</option>");
                });
                break;
            case "key":
                $targetmouse.hide();
                $targetkey.show();
                break;
        }
    });

    $(document).on("change", "select", function(){
        $(this).removeClass("error");
    });

    $(document).on("change", "input", function(){
        console.log($(this).val())
        if($(this).val().length !== 0){
            $(this).removeClass("error");
        }
    });
});
</script>

{% endblock %}